{
  "version": 3,
  "sources": ["../../../../../Modules/Administration/User/UserPage.ts", "../../../../../Modules/Administration/User/UserGrid.ts", "../../../../../Modules/Administration/UserPermission/UserPermissionDialog.ts", "../../../../../Modules/Administration/User/UserDialog.ts"],
  "sourcesContent": ["import { gridPageInit } from \"@serenity-is/corelib\"\nimport { UserGrid } from \"./UserGrid\";\n\nexport default () => gridPageInit(UserGrid);", "import { RoleRow, UserColumns, UserRow, UserService } from \"@/ServerTypes/Administration\";\nimport { Decorators, EntityGrid } from \"@serenity-is/corelib\";\nimport { Lookup, resolveUrl, tryFirst } from \"@serenity-is/corelib\";\nimport { UserDialog } from \"./UserDialog\";\n\n@Decorators.registerClass()\nexport class UserGrid extends EntityGrid<UserRow, any> {\n    protected getColumnsKey() { return UserColumns.columnsKey; }\n    protected getDialogType() { return UserDialog; }\n    protected getIdProperty() { return UserRow.idProperty; }\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\n    protected getService() { return UserService.baseUrl; }\n\n    constructor(props: any) {\n        super(props);\n    }\n\n    protected override getDefaultSortBy() {\n        return [UserRow.Fields.Username];\n    }\n\n    protected override createIncludeDeletedButton() {\n    }\n\n    protected override getColumns() {\n        var columns = super.getColumns();\n\n        var roles = tryFirst(columns, x => x.field == UserRow.Fields.Roles);\n        if (roles) {\n            var rolesLookup: Lookup<RoleRow>;\n            RoleRow.getLookupAsync().then(lookup => {\n                rolesLookup = lookup;\n                this.slickGrid.invalidate();\n            });\n\n            roles.format = ctx => {\n                if (!rolesLookup)\n                    return `<i class=\"fa fa-spinner\"></i>`;\n\n                var roleList = (ctx.value || []).map(x => (rolesLookup.itemById[x] || {}).RoleName || \"\");\n                roleList.sort();\n                return roleList.join(\", \");\n            };\n        }\n\n        return columns;\n    }\n}\n", "import { Decorators, TemplatedDialog } from \"@serenity-is/corelib\";\nimport { format, getRemoteData, notifySuccess, localText } from \"@serenity-is/corelib\";\nimport { UserPermissionService } from \"../\";\nimport { PermissionCheckEditor } from \"./PermissionCheckEditor\";\n\nexport class UserPermissionDialog extends TemplatedDialog<UserPermissionDialogOptions> {\n\n    private permissions: PermissionCheckEditor;\n\n    constructor(opt: UserPermissionDialogOptions) {\n        super(opt);\n\n        this.permissions = new PermissionCheckEditor({ element: this.byId('Permissions'), ... {\n            showRevoke: true\n        }});\n\n        UserPermissionService.List({\n            UserID: this.options.userID\n        }, response => {\n            this.permissions.value = response.Entities;\n        });\n\n        UserPermissionService.ListRolePermissions({\n            UserID: this.options.userID\n        }, response => {\n            this.permissions.rolePermissions = response.Entities;\n        });\n\n        this.permissions.implicitPermissions = getRemoteData('Administration.ImplicitPermissions');\n        this.dialogTitle = format(localText('Site.UserPermissionDialog.DialogTitle'),\n            this.options.username);\n    }\n\n    protected getDialogButtons() {\n        return [\n            {\n                text: localText('Dialogs.OkButton'),\n                cssClass: 'btn btn-primary',\n                click: e => {\n                    UserPermissionService.Update({\n                        UserID: this.options.userID,\n                        Permissions: this.permissions.value\n                    }, response => {\n                        this.dialogClose();\n                        window.setTimeout(() => notifySuccess(localText('Site.UserPermissionDialog.SaveSuccess')), 0);\n                    });\n                }\n            }, {\n                text: localText('Dialogs.CancelButton'),\n                click: () => this.dialogClose()\n            }\n        ];\n    }\n\n    protected getTemplate(): string {\n        return '<div id=\"~_Permissions\"></div>';\n    }\n}\n\nexport interface UserPermissionDialogOptions {\n    userID?: number;\n    username?: string;\n}\n", "import { UserForm, UserRow, UserService } from \"../\";\nimport { UserPermissionDialog } from \"../UserPermission/UserPermissionDialog\";\nimport { Decorators, EditorUtils, EntityDialog } from \"@serenity-is/corelib\"\nimport { format, localText } from \"@serenity-is/corelib\";\nimport { Texts } from \"@/ServerTypes/Texts\";\n\n@Decorators.registerClass()\nexport class UserDialog extends EntityDialog<UserRow, any> {\n    protected getFormKey() { return UserForm.formKey; }\n    protected getIdProperty() { return UserRow.idProperty; }\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\n    protected getNameProperty() { return UserRow.nameProperty; }\n    protected getService() { return UserService.baseUrl; }\n\n    protected form = new UserForm(this.idPrefix);\n\n    constructor(props?: any) {\n        super(props);\n\n        this.form.Password.change(() => {\n            EditorUtils.setRequired(this.form.PasswordConfirm, this.form.Password.value.length > 0);\n        });\n\n        this.form.Password.addValidationRule(this.uniqueName, e => {\n            if (this.form.Password.value.length < 6)\n                return format(localText(Texts.Validation.MinRequiredPasswordLength), 6);\n        });\n\n        this.form.PasswordConfirm.addValidationRule(this.uniqueName, e => {\n            if (this.form.Password.value != this.form.PasswordConfirm.value)\n                return localText(Texts.Validation.PasswordConfirmMismatch);\n        });\n    }\n\n    protected getToolbarButtons()\n    {\n        let buttons = super.getToolbarButtons();\n\n        buttons.push({\n            title: localText(Texts.Site.UserDialog.EditPermissionsButton),\n            cssClass: 'edit-permissions-button',\n            icon: 'fa-lock text-green',\n            onClick: () =>\n            {\n                new UserPermissionDialog({\n                    userID: this.entity.UserId,\n                    username: this.entity.Username\n                }).dialogOpen();\n            }\n        });\n\n        return buttons;\n    }\n\n    protected updateInterface() {\n        super.updateInterface();\n\n        this.toolbar.findButton(\"edit-permissions-button\").toggleClass(\"disabled\", this.isNewOrDeleted());\n    }\n\n    protected afterLoadEntity() {\n        super.afterLoadEntity();\n\n        // these fields are only required in new record mode\n        this.form.Password.element.toggleClass('required', this.isNew())\n            .closest('.field').findFirst('sup').toggle(this.isNew());\n        this.form.PasswordConfirm.element.toggleClass('required', this.isNew())\n            .closest('.field').findFirst('sup').toggle(this.isNew());\n    }\n}\n"],
  "mappings": "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",
  "names": ["import_corelib", "import_corelib", "import_corelib", "_UserPermissionDialog", "opt", "PermissionCheckEditor", "UserPermissionService", "response", "__name", "e", "UserPermissionDialog", "import_corelib", "_UserDialog_decorators", "_init", "_a", "_UserDialog", "props", "UserForm", "e", "Texts", "UserRow", "UserService", "buttons", "__name", "UserPermissionDialog", "__decoratorStart", "__decorateElement", "__runInitializers", "UserDialog", "_UserGrid_decorators", "_init", "_a", "_UserGrid", "UserColumns", "UserDialog", "UserRow", "UserService", "props", "columns", "roles", "x", "rolesLookup", "RoleRow", "lookup", "ctx", "roleList", "__decoratorStart", "__decorateElement", "__name", "__runInitializers", "UserGrid", "UserPage_default", "__name", "UserGrid"]
}
